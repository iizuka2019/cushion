<html>

  <head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0">
    <link rel="stylesheet" type="text/css" href="cushion.css" />
    <link rel="stylesheet" href="css/material-design-iconic-font.min.css">
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <link rel="stylesheet" href="css/jquery.circliful.css">
    <link rel="stylesheet" href="css/font-icon.css">
    <link href="https://fonts.googleapis.com/css?family=M+PLUS+Rounded+1c" rel="stylesheet">
    
    <!--[if lt IE 9]>
    <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/Chart.js/2.7.1/Chart.bundle.min.js"></script>
    <script src="https://www.gstatic.com/firebasejs/4.1.3/firebase.js"></script>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>週間情報</title>
    <style type="text/css">
.gnav__menu{
	display: flex;
        font-family: "M PLUS Rounded 1c"
}
.gnav__menu__leftitem{
	width: 5%;
	list-style: none;
}
.gnav__menu__centeritem{
	width: 80%;
	list-style: none;
}
.gnav__menu__rightitem{
	width: 10%;
	list-style: none;
}
    p.wf-roundedmplus1c { font-family: "M PLUS Rounded 1c";}
      p.wf-roundedmplus1c_title {
        font-family: "M PLUS Rounded 1c"
        line-height : normal ;
        border-bottom : 1px solid gray ;
      }
    </style>

    
   </head>

  <body>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.3/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.6/js/bootstrap.min.js"></script>
    <script src="js/jquery.circliful.js"></script>
    
    <script>!function(d,s,id){var js,fjs=d.getElementsByTagName(s)[0],p=/^http:/.test(d.location)?'http':'https';if(!d.getElementById(id)){js=d.createElement(s);js.id=id;js.src=p+'://platform.twitter.com/widgets.js';fjs.parentNode.insertBefore(js,fjs);}}(document, 'script', 'twitter-wjs');</script>
    
    
    <script>
        // Initialize Firebase
      
        var config = {
            apiKey: "AIzaSyAmSempEJ9w0lu8yYkFbdmpgI8nnlOC_YU",
            authDomain: "enebular-motion.firebaseapp.com",
            databaseURL: "https://enebular-motion.firebaseio.com",
            projectId: "enebular-motion",
            storageBucket: "enebular-motion.appspot.com",
            messagingSenderId: "367617695978",
            appId: "1:367617695978:web:8c3e2b04447dc024"
        };
        firebase.initializeApp(config);
    </script>
    
    <script>
    //読み込み処理
      var today = new Date();
      var strYear=today.getFullYear();
      var strMonth=dateToStrPad0Month(today.getMonth()+1);
      var strDay=dateToStrPad0Day(today.getDate());
      var strDataW = '0';
      
      function dateToStrPad0Day(date) {
        var format = "DD";
        format = format.replace(/DD/g, ('0' + date).slice(-2));
        return format;
      }
      
      function dateToStrPad0Month(date) {
        var format = "MM";
        format = format.replace(/MM/g, ('0' + date).slice(-2));
        return format;
      }
      //' + strYear + strMonth + strDay + '

      //alert(strYear + strMonth+strDay);

      firebase.database().ref('/' + strYear + strMonth+strDay + '/').on('value',function(snapshot) {
        document.getElementById("Sittingtime").innerHTML = snapshot.child("Sittingtime").val();


        strDataW=snapshot.child("stsum").val();
        var strdataH =0;
        strDataW =  Math.round((Number(strDataW)/60/60) * 10)/10;
        strdataH =  strDataW;
        strDataW =  (Number(strDataW)/8*100);
        
        document.getElementById("Standtime").innerHTML = snapshot.child("Standtime").val();  
        document.getElementById("status").innerHTML =strYear + '年' + strMonth + '月' + strDay + '日'

document.getElementById("TargetDate-text").innerHTML =strYear + strMonth + strDay
      });

    </script>
    
<section class="container">


    <script>
    //書き込み処理
     // var today = new Date();
     // var strYear=today.getFullYear();
     // var strMonth=today.getMonth()+1;
     // var strDate=today.getDate();
            
      var db = firebase.database();
      
      var myChatAll = db.ref("/myinfo/");
      function changeData(){
        var txtAge = document.getElementById("age-text").value;
        var txtWeight = document.getElementById("weight-text").value;
        
        var element = document.getElementById("gender") ;
        var elements = element.genders ;
        var strGender =  "";

        if (elements[0].checked == true){
          strGender = 'male' ;
        }else{
          strGender = 'female' ;
        }
        //myChatAll.set({age:txtAge, genders:strGender,myweight:txtWeight,weight:"0.1",Sittingtime:"16" ,Standtime:"41"});
        myChatAll.set({age:txtAge, genders:strGender,myweight:txtWeight});
      }
      
    </script>
  
  
    <script>
      function handlerToggleLed(strLR) {
        if(strLR == "left"){
          var today = document.getElementById("TargetDate-text").innerHTML;
          today.setDate(today.getDate() - 1);          
          
          var strYear=today.getFullYear();
          
          var strMonth=dateToStrPad0Month(today.getMonth()+1);
          var strDay=dateToStrPad0Day(today.getDate());
      
      function dateToStrPad0Day(date) {
        var format = "DD";
        format = format.replace(/DD/g, ('0' + date).slice(-2));
        return format;
      }
      
      function dateToStrPad0Month(date) {
        var format = "MM";
        format = format.replace(/MM/g, ('0' + date).slice(-2));
        return format;
      }
          
          document.getElementById("status").innerHTML =strYear + '年' + strMonth + '月' + strDay + '日'
        }
      }
    </script>
  
    
    <!-- Title -->
<p class="wf-roundedmplus1c">
	<nav class="gnav">
		 <ul class="gnav__menu">
			<li class="gnav__menu__leftitem"><a href="mypage.html"><i class="fa fa-user-o fa-lg"></i></a></li>
			<li class="gnav__menu__centeritem">CiliCill -シリシル-</li>
			<li class="gnav__menu__rightitem"><a href="index.html"><i class="fa fa-home fa-lg"></i></a></li>
		</ul>
	</nav>
</p>
	

<p class="wf-roundedmplus1c">
  <table class="device-info-table">
    <tr>
      <td colspan="2" align="center"><span id="status"  ></span></td>
    </tr>
    <tr>
      <td colspan="2" align="center"><span id="statusMan"  ></span></td>
    </tr>
  </table>
</p>
    
      <input type="HIDDEN" name="TargetDate" id="TargetDate-text" >
      <input type="HIDDEN" name="GraphLabel" id="GraphLabel-text" >

      <!-- Device Info Table -->
<hr>
  

<p class="wf-roundedmplus1c">  
  <table class="device-info-table">
    <tr>
          <td colspan="2" align="center">
  <div style="width: 100%; height: 400">
    <canvas id="myChart" style="width: 100%; height: 100%;"/>
  </div>
          </td>
        </tr>
        </table>
  </p>

  
</section>
    
    
  <script>
    //var ctx = document.getElementById("canvas").getContext("2d")
    var canvas = document.getElementById('myChart');
    var ctx = canvas.getContext('2d');
    
var date = new Date();
var before = new Date();
var week = [];
var weekStand = [];
var strValue=0;
	  
for(var i = 0;i < 7;i++) {
	before.setDate(date.getDate() - i);
	week.unshift(before.getMonth() + 1 + '月' + before.getDate() + '日');
	
	var strYearG=before.getFullYear();
	var strMonthG=dateToStrPad0Month(before.getMonth() + 1 );
	var strDayG=dateToStrPad0Day(before.getDate());
	
	
      //alert(strYear + strMonth+strDay);
	firebase.database().ref('/' + strYearG + strMonthG + strDayG + '/').on('value',function(snapshot) {
		//strValue=snapshot.child("Standtime").val();
		document.getElementById("GraphLabel-text").innerHTML =snapshot.child("Standtime").val();
	});
	alert(document.getElementById("GraphLabel-text").innerHTML);
	weekStand.unshift(document.getElementById("GraphLabel-text").innerHTML);
	
	
	
	
	
}

for (var i=0; i<weekStand.length;i++){
	alert(weekStand[i]);
}
 	  
      
	function dateToStrPad0Day(date) {
		var format = "DD";
		format = format.replace(/DD/g, ('0' + date).slice(-2));
		return format;
	}

	function dateToStrPad0Month(date) {
		var format = "MM";
		format = format.replace(/MM/g, ('0' + date).slice(-2));
		return format;
	}
          
	  
	  
	  new Chart(
  ctx, 
  {
    type: 'bar',
    data: {
      labels: week,
      datasets: [
        {
          type: 'line',
          label: '立上り回数',
          backgroundColor: 'rgb(33, 33, 33)',
          borderColor: 'rgb(33, 33, 33)',
          fill: false,
          yAxisID: 'yaxis2',
          tension: 0,
	  data:weekStand
        },
        {
          type: 'bar',
          label: '累計座位時間',
          stack: 'なし',
          backgroundColor: 'rgb(220, 215, 80)',
          yAxisID: 'yaxis1',
          data: [
            7.9,
            6.9,
            6.8,
            7.2,
            4.4,
            6,
            1
          ]
        },
      ]
    },
    options: {
      responsive: true,
      legend: {
        position: 'bottom'
      },
      scales: {
        xAxes: [
          { stacked: true }
        ],
        yAxes: [
          { 
            id: 'yaxis1',
            position: 'left',
            scaleLabel: {
              display: true,
              labelString: '累計座位時間(日)',
            },
            ticks: {
              max: 12,
              min: 0,
            },
            stacked: true 
          },
          { 
            id: 'yaxis2',
            position: 'right',
            scaleLabel: {
              display: true,
              labelString: '立上り回数(日)',
            },
            ticks: {
              max: 300,
              min: 0,
            },
            gridLines: {
              drawOnChartArea: false, 
            },
          }
        ]
      }
    },
  }
)
  </script>
  </body>

</html>
